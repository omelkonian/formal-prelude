<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Prelude.Map&#39;</title><link rel="stylesheet" href="css/Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- Maps with set witness, paired with a total function.</a>
<a id="130" class="Comment">------------------------------------------------------------------------</a>
<a id="203" class="Keyword">open</a> <a id="208" class="Keyword">import</a> <a id="215" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="228" class="Keyword">open</a> <a id="233" class="Keyword">import</a> <a id="240" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a>
<a id="254" class="Keyword">open</a> <a id="259" class="Keyword">import</a> <a id="266" href="Prelude.Default.html" class="Module">Prelude.Default</a>
<a id="282" class="Keyword">open</a> <a id="287" class="Keyword">import</a> <a id="294" href="Prelude.Set%2527.html" class="Module">Prelude.Set&#39;</a>

<a id="308" class="Keyword">module</a> <a id="315" href="Prelude.Map%2527.html" class="Module">Prelude.Map&#39;</a> <a id="328" class="Symbol">{</a><a id="329" href="Prelude.Map%2527.html#329" class="Bound">K</a> <a id="331" href="Prelude.Map%2527.html#331" class="Bound">V</a> <a id="333" class="Symbol">:</a> <a id="335" class="PrimitiveType">Set</a><a id="338" class="Symbol">}</a> <a id="340" class="Symbol">{{</a><a id="342" href="Prelude.Map%2527.html#342" class="Bound">_</a> <a id="344" class="Symbol">:</a> <a id="346" href="Prelude.DecEq.html#553" class="Record">DecEq</a> <a id="352" href="Prelude.Map%2527.html#329" class="Bound">K</a><a id="353" class="Symbol">}}</a> <a id="356" class="Keyword">where</a>

<a id="_↦_"></a><a id="363" href="Prelude.Map%2527.html#363" class="Function Operator">_↦_</a> <a id="367" class="Symbol">:</a> <a id="369" href="Prelude.Set%2527.html#947" class="Record">Set⟨</a> <a id="374" href="Prelude.Map%2527.html#329" class="Bound">K</a> <a id="376" href="Prelude.Set%2527.html#947" class="Record">⟩</a> <a id="378" class="Symbol">→</a> <a id="380" class="PrimitiveType">Set</a> <a id="384" class="Symbol">→</a> <a id="386" class="PrimitiveType">Set</a>
<a id="390" href="Prelude.Map%2527.html#390" class="Bound">ks</a> <a id="393" href="Prelude.Map%2527.html#363" class="Function Operator">↦</a> <a id="395" href="Prelude.Map%2527.html#395" class="Bound">V</a> <a id="397" class="Symbol">=</a> <a id="399" class="Symbol">∀</a> <a id="401" class="Symbol">{</a><a id="402" href="Prelude.Map%2527.html#402" class="Bound">k</a><a id="403" class="Symbol">}</a> <a id="405" class="Symbol">→</a> <a id="407" href="Prelude.Map%2527.html#402" class="Bound">k</a> <a id="409" href="Prelude.Set%2527.html#1820" class="Function Operator">∈′</a> <a id="412" href="Prelude.Map%2527.html#390" class="Bound">ks</a> <a id="415" class="Symbol">→</a> <a id="417" href="Prelude.Map%2527.html#395" class="Bound">V</a>

<a id="map↦"></a><a id="420" href="Prelude.Map%2527.html#420" class="Function">map↦</a> <a id="425" class="Symbol">=</a> <a id="427" href="Prelude.Map%2527.html#363" class="Function Operator">_↦_</a>
<a id="431" class="Keyword">syntax</a> <a id="438" href="Prelude.Map%2527.html#420" class="Function">map↦</a> <a id="443" class="Bound">ks</a> <a id="446" class="Symbol">(λ</a> <a id="449" class="Bound">k</a> <a id="451" class="Symbol">→</a> <a id="453" class="Bound">f</a><a id="454" class="Symbol">)</a> <a id="456" class="Symbol">=</a> <a id="458" class="Function">∀[</a> <a id="461" class="Bound">k</a> <a id="463" class="Function">∈</a> <a id="465" class="Bound">ks</a> <a id="468" class="Function">]</a> <a id="470" class="Bound">f</a>

<a id="dom′"></a><a id="473" href="Prelude.Map%2527.html#473" class="Function">dom′</a> <a id="478" class="Symbol">:</a> <a id="480" class="Symbol">∀</a> <a id="482" class="Symbol">{</a><a id="483" href="Prelude.Map%2527.html#483" class="Bound">ks</a><a id="485" class="Symbol">}</a> <a id="487" class="Symbol">→</a> <a id="489" href="Prelude.Map%2527.html#483" class="Bound">ks</a> <a id="492" href="Prelude.Map%2527.html#363" class="Function Operator">↦</a> <a id="494" href="Prelude.Map%2527.html#331" class="Bound">V</a> <a id="496" class="Symbol">→</a> <a id="498" href="Prelude.Set%2527.html#947" class="Record">Set⟨</a> <a id="503" href="Prelude.Map%2527.html#329" class="Bound">K</a> <a id="505" href="Prelude.Set%2527.html#947" class="Record">⟩</a>
<a id="507" href="Prelude.Map%2527.html#473" class="Function">dom′</a> <a id="512" class="Symbol">{</a><a id="513" class="Argument">ks</a> <a id="516" class="Symbol">=</a> <a id="518" href="Prelude.Map%2527.html#518" class="Bound">ks</a><a id="520" class="Symbol">}</a> <a id="522" class="Symbol">_</a> <a id="524" class="Symbol">=</a> <a id="526" href="Prelude.Map%2527.html#518" class="Bound">ks</a>

<a id="codom′"></a><a id="530" href="Prelude.Map%2527.html#530" class="Function">codom′</a> <a id="537" class="Symbol">:</a> <a id="539" class="Symbol">∀</a> <a id="541" class="Symbol">{</a><a id="542" href="Prelude.Map%2527.html#542" class="Bound">ks</a><a id="544" class="Symbol">}</a> <a id="546" class="Symbol">→</a> <a id="548" href="Prelude.Map%2527.html#542" class="Bound">ks</a> <a id="551" href="Prelude.Map%2527.html#363" class="Function Operator">↦</a> <a id="553" href="Prelude.Map%2527.html#331" class="Bound">V</a> <a id="555" class="Symbol">→</a> <a id="557" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="562" href="Prelude.Map%2527.html#331" class="Bound">V</a>
<a id="564" href="Prelude.Map%2527.html#530" class="Function">codom′</a> <a id="571" class="Symbol">=</a> <a id="573" href="Data.List.Membership.Setoid.html#1123" class="Function">mapWith∈</a> <a id="582" class="Symbol">_</a>

<a id="weaken-↦"></a><a id="585" href="Prelude.Map%2527.html#585" class="Function">weaken-↦</a> <a id="594" class="Symbol">:</a> <a id="596" class="Symbol">∀</a> <a id="598" class="Symbol">{</a><a id="599" href="Prelude.Map%2527.html#599" class="Bound">ks</a> <a id="602" href="Prelude.Map%2527.html#602" class="Bound">ys</a><a id="604" class="Symbol">}</a> <a id="606" class="Symbol">→</a> <a id="608" href="Prelude.Map%2527.html#599" class="Bound">ks</a> <a id="611" href="Prelude.Map%2527.html#363" class="Function Operator">↦</a> <a id="613" href="Prelude.Map%2527.html#331" class="Bound">V</a> <a id="615" class="Symbol">→</a> <a id="617" href="Prelude.Map%2527.html#602" class="Bound">ys</a> <a id="620" href="Prelude.Set%2527.html#1620" class="Function Operator">⊆′</a> <a id="623" href="Prelude.Map%2527.html#599" class="Bound">ks</a> <a id="626" class="Symbol">→</a> <a id="628" href="Prelude.Map%2527.html#602" class="Bound">ys</a> <a id="631" href="Prelude.Map%2527.html#363" class="Function Operator">↦</a> <a id="633" href="Prelude.Map%2527.html#331" class="Bound">V</a>
<a id="635" href="Prelude.Map%2527.html#585" class="Function">weaken-↦</a> <a id="644" href="Prelude.Map%2527.html#644" class="Bound">f</a> <a id="646" href="Prelude.Map%2527.html#646" class="Bound">ys⊆ks</a> <a id="652" class="Symbol">=</a> <a id="654" href="Prelude.Map%2527.html#644" class="Bound">f</a> <a id="656" href="Function.Base.html#992" class="Function Operator">∘</a> <a id="658" href="Prelude.Map%2527.html#646" class="Bound">ys⊆ks</a>

<a id="665" class="Comment">-- extend-↦ : ∀ {ks ys zs : List K}</a>
<a id="701" class="Comment">--   → zs ↭ ks ++ ys</a>
<a id="722" class="Comment">--   → ks ↦′ P</a>
<a id="737" class="Comment">--   → ys ↦′ P</a>
<a id="752" class="Comment">--   → zs ↦′ P</a>
<a id="767" class="Comment">-- extend-↦ zs↭ ks↦ ys↦ p∈ with ∈-++⁻ _ (∈-resp-↭ zs↭ p∈)</a>
<a id="825" class="Comment">-- ... | inj₁ k∈ = ks↦ k∈</a>
<a id="851" class="Comment">-- ... | inj₂ y∈ = ys↦ y∈</a>

<a id="Map&#39;"></a><a id="878" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a> <a id="883" class="Symbol">:</a> <a id="885" class="PrimitiveType">Set</a>
<a id="889" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a> <a id="894" class="Symbol">=</a> <a id="896" href="Data.Product.html#1369" class="Function">∃</a> <a id="898" class="Symbol">(</a><a id="899" href="Prelude.Map%2527.html#363" class="Function Operator">_↦</a> <a id="902" href="Prelude.Map%2527.html#331" class="Bound">V</a><a id="903" class="Symbol">)</a>

<a id="dom"></a><a id="906" href="Prelude.Map%2527.html#906" class="Function">dom</a> <a id="910" class="Symbol">:</a> <a id="912" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a> <a id="917" class="Symbol">→</a> <a id="919" href="Prelude.Set%2527.html#947" class="Record">Set⟨</a> <a id="924" href="Prelude.Map%2527.html#329" class="Bound">K</a> <a id="926" href="Prelude.Set%2527.html#947" class="Record">⟩</a>
<a id="928" href="Prelude.Map%2527.html#906" class="Function">dom</a> <a id="932" class="Symbol">=</a> <a id="934" href="Agda.Builtin.Sigma.html#252" class="Field">proj₁</a>

<a id="codom"></a><a id="941" href="Prelude.Map%2527.html#941" class="Function">codom</a> <a id="947" class="Symbol">:</a> <a id="949" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a> <a id="954" class="Symbol">→</a> <a id="956" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="961" href="Prelude.Map%2527.html#331" class="Bound">V</a>
<a id="963" href="Prelude.Map%2527.html#941" class="Function">codom</a> <a id="969" class="Symbol">(</a><a id="970" href="Prelude.Map%2527.html#970" class="Bound">ks</a> <a id="973" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="975" href="Prelude.Map%2527.html#975" class="Bound">m</a><a id="976" class="Symbol">)</a> <a id="978" class="Symbol">=</a> <a id="980" href="Prelude.Map%2527.html#530" class="Function">codom′</a> <a id="987" class="Symbol">{</a><a id="988" href="Prelude.Map%2527.html#970" class="Bound">ks</a><a id="990" class="Symbol">}</a> <a id="992" href="Prelude.Map%2527.html#975" class="Bound">m</a>

<a id="lookup"></a><a id="995" href="Prelude.Map%2527.html#995" class="Function">lookup</a> <a id="1002" class="Symbol">:</a> <a id="1004" class="Symbol">∀</a> <a id="1006" class="Symbol">{</a><a id="1007" href="Prelude.Map%2527.html#1007" class="Bound">k</a><a id="1008" class="Symbol">}</a> <a id="1010" class="Symbol">→</a> <a id="1012" class="Symbol">(</a><a id="1013" href="Prelude.Map%2527.html#1013" class="Bound">m</a> <a id="1015" class="Symbol">:</a> <a id="1017" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a><a id="1021" class="Symbol">)</a> <a id="1023" class="Symbol">→</a> <a id="1025" href="Prelude.Map%2527.html#1007" class="Bound">k</a> <a id="1027" href="Prelude.Set%2527.html#1820" class="Function Operator">∈′</a> <a id="1030" href="Prelude.Map%2527.html#906" class="Function">dom</a> <a id="1034" href="Prelude.Map%2527.html#1013" class="Bound">m</a> <a id="1036" class="Symbol">→</a> <a id="1038" href="Prelude.Map%2527.html#331" class="Bound">V</a>
<a id="1040" href="Prelude.Map%2527.html#995" class="Function">lookup</a> <a id="1047" class="Symbol">(_</a> <a id="1050" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1052" href="Prelude.Map%2527.html#1052" class="Bound">k↦</a><a id="1054" class="Symbol">)</a> <a id="1056" href="Prelude.Map%2527.html#1056" class="Bound">k∈</a> <a id="1059" class="Symbol">=</a> <a id="1061" href="Prelude.Map%2527.html#1052" class="Bound">k↦</a> <a id="1064" href="Prelude.Map%2527.html#1056" class="Bound">k∈</a>

<a id="lookup′"></a><a id="1068" href="Prelude.Map%2527.html#1068" class="Function">lookup′</a> <a id="1076" class="Symbol">:</a> <a id="1078" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a> <a id="1083" class="Symbol">→</a> <a id="1085" href="Prelude.Map%2527.html#329" class="Bound">K</a> <a id="1087" class="Symbol">→</a> <a id="1089" href="Data.Maybe.Base.html#838" class="Datatype">Maybe</a> <a id="1095" href="Prelude.Map%2527.html#331" class="Bound">V</a>
<a id="1097" href="Prelude.Map%2527.html#1068" class="Function">lookup′</a> <a id="1105" href="Prelude.Map%2527.html#1105" class="Bound">m</a> <a id="1107" href="Prelude.Map%2527.html#1107" class="Bound">k</a> <a id="1109" class="Keyword">with</a> <a id="1114" href="Prelude.Map%2527.html#1107" class="Bound">k</a> <a id="1116" href="Prelude.Set%2527.html#1898" class="Function Operator">∈′?</a> <a id="1120" href="Prelude.Map%2527.html#906" class="Function">dom</a> <a id="1124" href="Prelude.Map%2527.html#1105" class="Bound">m</a>
<a id="1126" class="Symbol">...</a> <a id="1130" class="Symbol">|</a> <a id="1132" href="Relation.Nullary.html#1645" class="InductiveConstructor">yes</a> <a id="1136" href="Prelude.Map%2527.html#1136" class="Bound">k∈</a> <a id="1139" class="Symbol">=</a> <a id="1141" href="Data.Maybe.Base.html#892" class="InductiveConstructor">just</a> <a id="1146" class="Symbol">(</a><a id="1147" href="Prelude.Map%2527.html#995" class="Function">lookup</a> <a id="1154" class="Bound">m</a> <a id="1156" href="Prelude.Map%2527.html#1136" class="Bound">k∈</a><a id="1158" class="Symbol">)</a>
<a id="1160" class="Symbol">...</a> <a id="1164" class="Symbol">|</a> <a id="1166" href="Relation.Nullary.html#1682" class="InductiveConstructor">no</a>  <a id="1170" class="Symbol">_</a>  <a id="1173" class="Symbol">=</a> <a id="1175" href="Data.Maybe.Base.html#872" class="InductiveConstructor">nothing</a>

<a id="update"></a><a id="1184" href="Prelude.Map%2527.html#1184" class="Function">update</a> <a id="1191" class="Symbol">:</a> <a id="1193" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a> <a id="1198" class="Symbol">→</a> <a id="1200" href="Prelude.Map%2527.html#329" class="Bound">K</a> <a id="1202" class="Symbol">→</a> <a id="1204" class="Symbol">(</a><a id="1205" href="Prelude.Map%2527.html#331" class="Bound">V</a> <a id="1207" class="Symbol">→</a> <a id="1209" href="Prelude.Map%2527.html#331" class="Bound">V</a><a id="1210" class="Symbol">)</a> <a id="1212" class="Symbol">→</a> <a id="1214" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a>
<a id="1219" href="Prelude.Map%2527.html#1184" class="Function">update</a> <a id="1226" href="Prelude.Map%2527.html#1226" class="Bound">m</a><a id="1227" class="Symbol">@(</a><a id="1229" href="Prelude.Map%2527.html#1229" class="Bound">ks</a> <a id="1232" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1234" href="Prelude.Map%2527.html#1234" class="Bound">k↦</a><a id="1236" class="Symbol">)</a> <a id="1238" href="Prelude.Map%2527.html#1238" class="Bound">k′</a> <a id="1241" href="Prelude.Map%2527.html#1241" class="Bound">f</a> <a id="1243" class="Symbol">=</a> <a id="1245" href="Prelude.Map%2527.html#1229" class="Bound">ks</a> <a id="1248" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1250" class="Symbol">λ</a> <a id="1252" class="Symbol">{</a><a id="1253" href="Prelude.Map%2527.html#1253" class="Bound">k</a><a id="1254" class="Symbol">}</a> <a id="1256" class="Symbol">→</a> <a id="1258" class="Symbol">(</a><a id="1259" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="1262" href="Prelude.Map%2527.html#1253" class="Bound">k</a> <a id="1264" href="Prelude.DecEq.html#625" class="Function Operator">==</a> <a id="1267" href="Prelude.Map%2527.html#1238" class="Bound">k′</a> <a id="1270" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="1275" href="Prelude.Map%2527.html#1241" class="Bound">f</a> <a id="1277" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="1282" class="Symbol">(λ</a> <a id="1285" href="Prelude.Map%2527.html#1285" class="Bound">x</a> <a id="1287" class="Symbol">→</a> <a id="1289" href="Prelude.Map%2527.html#1285" class="Bound">x</a><a id="1290" class="Symbol">))</a> <a id="1293" href="Function.Base.html#992" class="Function Operator">∘</a> <a id="1295" href="Prelude.Map%2527.html#1234" class="Bound">k↦</a>

<a id="update-const"></a><a id="1299" href="Prelude.Map%2527.html#1299" class="Function">update-const</a> <a id="1312" class="Symbol">:</a> <a id="1314" class="Symbol">∀</a> <a id="1316" class="Symbol">{</a><a id="1317" href="Prelude.Map%2527.html#1317" class="Bound">m</a> <a id="1319" href="Prelude.Map%2527.html#1319" class="Bound">k</a> <a id="1321" href="Prelude.Map%2527.html#1321" class="Bound">f</a><a id="1322" class="Symbol">}</a> <a id="1324" class="Symbol">→</a> <a id="1326" href="Prelude.Map%2527.html#906" class="Function">dom</a> <a id="1330" href="Prelude.Map%2527.html#1317" class="Bound">m</a> <a id="1332" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="1334" href="Prelude.Map%2527.html#906" class="Function">dom</a> <a id="1338" class="Symbol">(</a><a id="1339" href="Prelude.Map%2527.html#1184" class="Function">update</a> <a id="1346" href="Prelude.Map%2527.html#1317" class="Bound">m</a> <a id="1348" href="Prelude.Map%2527.html#1319" class="Bound">k</a> <a id="1350" href="Prelude.Map%2527.html#1321" class="Bound">f</a><a id="1351" class="Symbol">)</a>
<a id="1353" href="Prelude.Map%2527.html#1299" class="Function">update-const</a> <a id="1366" class="Symbol">=</a> <a id="1368" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="updateWith"></a><a id="1374" href="Prelude.Map%2527.html#1374" class="Function">updateWith</a> <a id="1385" class="Symbol">:</a> <a id="1387" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a> <a id="1392" class="Symbol">→</a> <a id="1394" href="Prelude.Map%2527.html#329" class="Bound">K</a> <a id="1396" class="Symbol">→</a> <a id="1398" href="Prelude.Map%2527.html#331" class="Bound">V</a> <a id="1400" class="Symbol">→</a> <a id="1402" class="Symbol">(</a><a id="1403" href="Prelude.Map%2527.html#331" class="Bound">V</a> <a id="1405" class="Symbol">→</a> <a id="1407" href="Prelude.Map%2527.html#331" class="Bound">V</a><a id="1408" class="Symbol">)</a> <a id="1410" class="Symbol">→</a> <a id="1412" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a>
<a id="1417" href="Prelude.Map%2527.html#1374" class="Function">updateWith</a> <a id="1428" href="Prelude.Map%2527.html#1428" class="Bound">m</a><a id="1429" class="Symbol">@(</a><a id="1431" href="Prelude.Map%2527.html#1431" class="Bound">ks</a> <a id="1434" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1436" href="Prelude.Map%2527.html#1436" class="Bound">k↦</a><a id="1438" class="Symbol">)</a> <a id="1440" href="Prelude.Map%2527.html#1440" class="Bound">k</a> <a id="1442" href="Prelude.Map%2527.html#1442" class="Bound">k-def</a> <a id="1448" href="Prelude.Map%2527.html#1448" class="Bound">f</a> <a id="1450" class="Keyword">with</a> <a id="1455" href="Prelude.Map%2527.html#1440" class="Bound">k</a> <a id="1457" href="Prelude.Set%2527.html#1898" class="Function Operator">∈′?</a> <a id="1461" href="Prelude.Map%2527.html#1431" class="Bound">ks</a>
<a id="1464" class="Symbol">...</a> <a id="1468" class="Symbol">|</a> <a id="1470" href="Relation.Nullary.html#1645" class="InductiveConstructor">yes</a> <a id="1474" href="Prelude.Map%2527.html#1474" class="Bound">k∈</a> <a id="1477" class="Symbol">=</a> <a id="1479" class="Bound">ks</a>           <a id="1492" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1494" class="Bound">f</a> <a id="1496" href="Function.Base.html#992" class="Function Operator">∘</a> <a id="1498" class="Bound">k↦</a>
<a id="1501" class="Symbol">...</a> <a id="1505" class="Symbol">|</a> <a id="1507" href="Relation.Nullary.html#1682" class="InductiveConstructor">no</a>  <a id="1511" href="Prelude.Map%2527.html#1511" class="Bound">k∉</a> <a id="1514" class="Symbol">=</a> <a id="1516" class="Bound">k</a> <a id="1518" href="Prelude.Set%2527.html#2001" class="Function Operator">∷</a> <a id="1520" class="Bound">ks</a> <a id="1523" href="Prelude.Set%2527.html#2001" class="Function Operator">∶-</a> <a id="1526" href="Prelude.Map%2527.html#1511" class="Bound">k∉</a> <a id="1529" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1531" class="Symbol">λ{</a> <a id="1534" class="Symbol">(</a><a id="1535" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="1540" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="1544" class="Symbol">)</a> <a id="1546" class="Symbol">→</a> <a id="1548" class="Bound">f</a> <a id="1550" class="Bound">k-def</a><a id="1555" class="Symbol">;</a> <a id="1557" class="Symbol">(</a><a id="1558" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="1564" href="Prelude.Map%2527.html#1564" class="Bound">k∈′</a><a id="1567" class="Symbol">)</a> <a id="1569" class="Symbol">→</a> <a id="1571" class="Bound">k↦</a> <a id="1574" href="Prelude.Map%2527.html#1564" class="Bound">k∈′</a> <a id="1578" class="Symbol">}</a>

<a id="1581" class="Comment">-- we get extra utilities if we can get a default value when there is no entry for a particular key</a>
<a id="1681" class="Keyword">module</a> <a id="1688" href="Prelude.Map%2527.html#1688" class="Module">_</a> <a id="1690" class="Symbol">{{</a><a id="1692" href="Prelude.Map%2527.html#1692" class="Bound">_</a> <a id="1694" class="Symbol">:</a> <a id="1696" href="Prelude.Default.html#676" class="Record">Default</a> <a id="1704" href="Prelude.Map%2527.html#331" class="Bound">V</a><a id="1705" class="Symbol">}}</a> <a id="1708" class="Keyword">where</a>
  <a id="1716" href="Prelude.Map%2527.html#1716" class="Function">update-with-def</a> <a id="1732" class="Symbol">:</a> <a id="1734" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a> <a id="1739" class="Symbol">→</a> <a id="1741" href="Prelude.Map%2527.html#329" class="Bound">K</a> <a id="1743" class="Symbol">→</a> <a id="1745" class="Symbol">(</a><a id="1746" href="Prelude.Map%2527.html#331" class="Bound">V</a> <a id="1748" class="Symbol">→</a> <a id="1750" href="Prelude.Map%2527.html#331" class="Bound">V</a><a id="1751" class="Symbol">)</a> <a id="1753" class="Symbol">→</a> <a id="1755" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a>
  <a id="1762" href="Prelude.Map%2527.html#1716" class="Function">update-with-def</a> <a id="1778" href="Prelude.Map%2527.html#1778" class="Bound">m</a> <a id="1780" href="Prelude.Map%2527.html#1780" class="Bound">k</a> <a id="1782" href="Prelude.Map%2527.html#1782" class="Bound">f</a> <a id="1784" class="Symbol">=</a> <a id="1786" href="Prelude.Map%2527.html#1374" class="Function">updateWith</a> <a id="1797" href="Prelude.Map%2527.html#1778" class="Bound">m</a> <a id="1799" href="Prelude.Map%2527.html#1780" class="Bound">k</a> <a id="1801" href="Prelude.Default.html#736" class="Field">def</a> <a id="1805" href="Prelude.Map%2527.html#1782" class="Bound">f</a>

<a id="union"></a><a id="1808" href="Prelude.Map%2527.html#1808" class="Function">union</a> <a id="1814" class="Symbol">:</a> <a id="1816" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a> <a id="1821" class="Symbol">→</a> <a id="1823" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a> <a id="1828" class="Symbol">→</a> <a id="1830" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a>
<a id="1835" href="Prelude.Map%2527.html#1808" class="Function">union</a> <a id="1841" class="Symbol">(</a><a id="1842" href="Prelude.Map%2527.html#1842" class="Bound">xs</a> <a id="1845" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1847" href="Prelude.Map%2527.html#1847" class="Bound">X</a><a id="1848" class="Symbol">)</a> <a id="1850" class="Symbol">(</a><a id="1851" href="Prelude.Map%2527.html#1851" class="Bound">ys</a> <a id="1854" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1856" href="Prelude.Map%2527.html#1856" class="Bound">Y</a><a id="1857" class="Symbol">)</a> <a id="1859" class="Symbol">=</a> <a id="1861" class="Symbol">(</a><a id="1862" href="Prelude.Map%2527.html#1842" class="Bound">xs</a> <a id="1865" href="Prelude.Set%2527.html#2728" class="Function Operator">∪</a> <a id="1867" href="Prelude.Map%2527.html#1851" class="Bound">ys</a><a id="1869" class="Symbol">)</a> <a id="1871" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1873" href="Prelude.Map%2527.html#1889" class="Function">X∪Y</a>
  <a id="1879" class="Keyword">where</a>
    <a id="1889" href="Prelude.Map%2527.html#1889" class="Function">X∪Y</a> <a id="1893" class="Symbol">:</a> <a id="1895" class="Symbol">(</a><a id="1896" href="Prelude.Map%2527.html#1842" class="Bound">xs</a> <a id="1899" href="Prelude.Set%2527.html#2728" class="Function Operator">∪</a> <a id="1901" href="Prelude.Map%2527.html#1851" class="Bound">ys</a><a id="1903" class="Symbol">)</a> <a id="1905" href="Prelude.Map%2527.html#363" class="Function Operator">↦</a> <a id="1907" href="Prelude.Map%2527.html#331" class="Bound">V</a>
    <a id="1913" href="Prelude.Map%2527.html#1889" class="Function">X∪Y</a> <a id="1917" href="Prelude.Map%2527.html#1917" class="Bound">xy∈</a> <a id="1921" class="Keyword">with</a> <a id="1926" href="Prelude.Set%2527.html#7197" class="Function">∈-∪⁻</a> <a id="1931" class="Symbol">{</a><a id="1932" class="Argument">xs</a> <a id="1935" class="Symbol">=</a> <a id="1937" href="Prelude.Map%2527.html#1842" class="Bound">xs</a><a id="1939" class="Symbol">}</a> <a id="1941" class="Symbol">{</a><a id="1942" class="Argument">ys</a> <a id="1945" class="Symbol">=</a> <a id="1947" href="Prelude.Map%2527.html#1851" class="Bound">ys</a><a id="1949" class="Symbol">}</a> <a id="1951" href="Prelude.Map%2527.html#1917" class="Bound">xy∈</a>
    <a id="1959" class="Symbol">...</a> <a id="1963" class="Symbol">|</a> <a id="1965" href="Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="1970" href="Prelude.Map%2527.html#1970" class="Bound">x∈</a> <a id="1973" class="Symbol">=</a> <a id="1975" href="Prelude.Map%2527.html#1847" class="Bound">X</a> <a id="1977" href="Prelude.Map%2527.html#1970" class="Bound">x∈</a>
    <a id="1984" class="Symbol">...</a> <a id="1988" class="Symbol">|</a> <a id="1990" href="Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="1995" href="Prelude.Map%2527.html#1995" class="Bound">y∈</a> <a id="1998" class="Symbol">=</a> <a id="2000" href="Prelude.Map%2527.html#1856" class="Bound">Y</a> <a id="2002" href="Prelude.Map%2527.html#1995" class="Bound">y∈</a>

<a id="_≡ᵐ_"></a><a id="2006" href="Prelude.Map%2527.html#2006" class="Function Operator">_≡ᵐ_</a> <a id="2011" class="Symbol">:</a> <a id="2013" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a> <a id="2018" class="Symbol">→</a> <a id="2020" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a> <a id="2025" class="Symbol">→</a> <a id="2027" class="PrimitiveType">Set</a>
<a id="2031" href="Prelude.Map%2527.html#2031" class="Bound">m</a> <a id="2033" href="Prelude.Map%2527.html#2006" class="Function Operator">≡ᵐ</a> <a id="2036" href="Prelude.Map%2527.html#2036" class="Bound">m′</a> <a id="2039" class="Symbol">=</a> <a id="2041" class="Symbol">(</a><a id="2042" href="Prelude.Map%2527.html#906" class="Function">dom</a> <a id="2046" href="Prelude.Map%2527.html#2031" class="Bound">m</a> <a id="2048" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="2050" href="Prelude.Map%2527.html#906" class="Function">dom</a> <a id="2054" href="Prelude.Map%2527.html#2036" class="Bound">m′</a><a id="2056" class="Symbol">)</a> <a id="2058" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="2060" class="Symbol">(</a><a id="2061" href="Prelude.Map%2527.html#941" class="Function">codom</a> <a id="2067" href="Prelude.Map%2527.html#2031" class="Bound">m</a> <a id="2069" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="2071" href="Prelude.Map%2527.html#941" class="Function">codom</a> <a id="2077" href="Prelude.Map%2527.html#2036" class="Bound">m′</a><a id="2079" class="Symbol">)</a>

<a id="2082" class="Keyword">postulate</a>
  <a id="union-comm"></a><a id="2094" href="Prelude.Map%2527.html#2094" class="Postulate">union-comm</a> <a id="2105" class="Symbol">:</a> <a id="2107" class="Symbol">∀</a> <a id="2109" class="Symbol">{</a><a id="2110" href="Prelude.Map%2527.html#2110" class="Bound">m</a> <a id="2112" href="Prelude.Map%2527.html#2112" class="Bound">m′</a><a id="2114" class="Symbol">}</a> <a id="2116" class="Symbol">→</a> <a id="2118" href="Prelude.Map%2527.html#1808" class="Function">union</a> <a id="2124" href="Prelude.Map%2527.html#2110" class="Bound">m</a> <a id="2126" href="Prelude.Map%2527.html#2112" class="Bound">m′</a> <a id="2129" href="Prelude.Map%2527.html#2006" class="Function Operator">≡ᵐ</a> <a id="2132" href="Prelude.Map%2527.html#1808" class="Function">union</a> <a id="2138" href="Prelude.Map%2527.html#2112" class="Bound">m′</a> <a id="2141" href="Prelude.Map%2527.html#2110" class="Bound">m</a>
  <a id="≡ᵐ-trans"></a><a id="2145" href="Prelude.Map%2527.html#2145" class="Postulate">≡ᵐ-trans</a> <a id="2154" class="Symbol">:</a> <a id="2156" class="Symbol">∀</a> <a id="2158" class="Symbol">{</a><a id="2159" href="Prelude.Map%2527.html#2159" class="Bound">m</a> <a id="2161" href="Prelude.Map%2527.html#2161" class="Bound">m′</a> <a id="2164" href="Prelude.Map%2527.html#2164" class="Bound">m″</a><a id="2166" class="Symbol">}</a> <a id="2168" class="Symbol">→</a> <a id="2170" href="Prelude.Map%2527.html#2159" class="Bound">m</a> <a id="2172" href="Prelude.Map%2527.html#2006" class="Function Operator">≡ᵐ</a> <a id="2175" href="Prelude.Map%2527.html#2161" class="Bound">m′</a> <a id="2178" class="Symbol">→</a> <a id="2180" href="Prelude.Map%2527.html#2161" class="Bound">m′</a> <a id="2183" href="Prelude.Map%2527.html#2006" class="Function Operator">≡ᵐ</a> <a id="2186" href="Prelude.Map%2527.html#2164" class="Bound">m″</a> <a id="2189" class="Symbol">→</a> <a id="2191" href="Prelude.Map%2527.html#2159" class="Bound">m</a> <a id="2193" href="Prelude.Map%2527.html#2006" class="Function Operator">≡ᵐ</a> <a id="2196" href="Prelude.Map%2527.html#2164" class="Bound">m″</a>
<a id="2199" class="Comment">-- union-comm {m = xs , X} {m′ = ys , Y}</a>
<a id="2240" class="Comment">--   with _ , X∪Y ← union (xs , X) (ys , Y)</a>
<a id="2284" class="Comment">--   with _ , Y∪X ← union (ys , Y) (xs , X)</a>
<a id="2328" class="Comment">--   rewrite ∪-comm {xs = xs}{ys}</a>
<a id="2362" class="Comment">--     = refl , p</a>
<a id="2380" class="Comment">--     where</a>
<a id="2393" class="Comment">--       p : codom (_ , X∪Y) ≡ codom (_ , Y∪X)</a>
<a id="2440" class="Comment">--       p = ?</a>

<a id="2456" class="Comment">-- update-comm : ∀ {m k f k′ f′}</a>
<a id="2489" class="Comment">--   → [T0D0] f ∘ f&#39; = f&#39; ∘ f</a>
<a id="2519" class="Comment">--   → update (update m k f) k′ f′</a>
<a id="2554" class="Comment">--   ≡ update (update m k′ f′) k f</a>
<a id="2589" class="Comment">-- update-comm {m@(ks , k↦)}{k}{f}{k′}{f′}</a>
<a id="2632" class="Comment">--   with k ∈′? ks | k′ ∈′? ks</a>
<a id="2663" class="Comment">-- ... | yes k∈ | yes k∈′ = {!!}</a>
<a id="2696" class="Comment">-- ... | yes k∈ | no  k∉′ = {!!}</a>
<a id="2729" class="Comment">-- ... | no  k∉ | yes k∈′ = {!!}</a>
<a id="2762" class="Comment">-- ... | no  k∉ | no  k∉′ = {!!}</a>


<a id="2797" class="Comment">-- update m k f</a>
<a id="2813" class="Comment">-- m ∥ k ≔ f</a>
<a id="2826" class="Comment">-- m</a>

<a id="2832" class="Comment">-- update : ∀ {K V : Set} {{_ : DecEq K}} {ks : List K} {k : K}</a>
<a id="2896" class="Comment">--   → ks ↦ V</a>
<a id="2910" class="Comment">--   → (k ∈ ks) × (V → V)</a>
<a id="2936" class="Comment">--   → ks ↦ V</a>
<a id="2950" class="Comment">-- update {k = k} m (k∈ , f) {k′} k∈′</a>
<a id="2988" class="Comment">--   with v ← m k∈′</a>
<a id="3008" class="Comment">--   with k ≟ k′</a>
<a id="3025" class="Comment">-- ... | yes refl = f v</a>
<a id="3049" class="Comment">-- ... | no  ¬p   = v</a>

<a id="3072" class="Comment">-- updateˢ : S → Part × ℤ × (ℤ → ℤ) → S</a>
<a id="3112" class="Comment">-- updateˢ (ps , s) (p , pz , f)</a>
<a id="3145" class="Comment">--   with p ∈? ps</a>
<a id="3163" class="Comment">-- ... | yes p∈ = _ , update s (p∈ , f)</a>
<a id="3203" class="Comment">-- ... | no  p∉ = p ∷ ps , s′</a>
<a id="3233" class="Comment">--   where</a>
<a id="3244" class="Comment">--     s′ : (p ∷ ps) ↦ ℤ</a>
<a id="3269" class="Comment">--     s′ (here refl) = f pz</a>
<a id="3298" class="Comment">--     s′ (there p∈′) = s p∈′</a>

<a id="3329" class="Comment">-- update : ∀ {K V : Set} {xs : List K}</a>
<a id="3369" class="Comment">--   → ∃ (</a>
<a id="3380" class="Comment">--   → K</a>
<a id="3389" class="Comment">--   → (V → V)</a>
<a id="3404" class="Comment">--   → ∃ (_↦ V)</a>
<a id="3420" class="Comment">-- update {K}{V}{xs} (xs , f) x mod</a>
<a id="3456" class="Comment">--   with x ∈ xs</a>
<a id="3473" class="Comment">-- ... | yes x∈ = f x∈</a>
<a id="3496" class="Comment">-- ... | no  x∉ =</a>

<a id="3515" class="Comment">-----------------------------------------------------</a>
<a id="3569" class="Comment">-- Syntactic sugar</a>
<a id="3588" class="Keyword">syntax</a> <a id="3595" href="Prelude.Map%2527.html#878" class="Function">Map&#39;</a> <a id="3600" class="Symbol">{</a>K <a id="3603" class="Symbol">=</a> <a id="3605" class="Bound">K</a><a id="3606" class="Symbol">}</a> <a id="3608" class="Symbol">{</a>V <a id="3611" class="Symbol">=</a> <a id="3613" class="Bound">V</a><a id="3614" class="Symbol">}</a> <a id="3616" class="Symbol">=</a> <a id="3618" class="Function">Map⟨</a> <a id="3623" class="Bound">K</a> <a id="3625" class="Function">↦</a> <a id="3627" class="Bound">V</a> <a id="3629" class="Function">⟩</a>
</pre></body></html>